<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Расписание класса</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #171a22;
      --text: #e6e6e6;
      --muted: #9aa0a6;
      --accent: #6aa6ff;
      --ok: #54d17a;
      --warn: #ffb84d;
      --border: #2a2f3a;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    header { padding:16px; border-bottom:1px solid var(--border); }
    header h1 { margin:0 0 6px; font-size:22px; }
    header p { margin:0; color:var(--muted); font-size:14px; }

    .wrap { max-width:980px; margin:0 auto; padding:16px; display:grid; gap:16px; grid-template-columns: 1fr; }
    @media (min-width: 880px) { .wrap { grid-template-columns: 2fr 1fr; } }

    .panel { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:16px; }
    .panel h2 { margin:0 0 12px; font-size:18px; }
    .panel h3 { margin:16px 0 8px; font-size:16px; color:var(--muted); }

    .day-card { border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-bottom:12px; }
    .day-head { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#1c2029; border-bottom:1px solid var(--border); }
    .day-head .name { font-weight:600; }
    .day-head .date { color:var(--muted); font-size:13px; }

    .lessons { list-style:none; margin:0; padding:0; }
    .lessons li { display:flex; gap:12px; align-items:center; padding:10px 12px; border-bottom:1px dashed var(--border); }
    .lessons li:last-child { border-bottom:none; }
    .slot { width:28px; height:28px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border); border-radius:6px; color:var(--muted); font-size:13px; }
    .subject { flex:1; font-weight:500; }
    .valgfag { color:var(--accent); }
    .muted { color:var(--muted); }

    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    select, button { background:#202532; color:var(--text); border:1px solid var(--border); border-radius:8px; padding:10px 12px; }
    button { cursor:pointer; }
    button.primary { background:#25406a; border-color:#30507f; }
    button.primary:hover { background:#2a4774; }
    .note { font-size:13px; color:var(--muted); }

    .stats { display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
    .stat { padding:10px; border:1px solid var(--border); border-radius:10px; background:#1a1e26; }
    .stat .label { font-size:12px; color:var(--muted); }
    .stat .value { font-size:18px; font-weight:600; }

    .ok { color:var(--ok); }
    .warn { color:var(--warn); }
  </style>
</head>
<body>
  <header>
    <h1>Расписание класса</h1>
    <p>Сегодня и завтра — с учётом выбранного Valgfag</p>
  </header>

  <main class="wrap">
    <section class="panel">
      <h2>Ваше расписание</h2>
      <div id="days"></div>
    </section>

    <aside class="panel">
      <h2>Valgfag (доп. урок)</h2>
      <div class="row">
        <select id="valgfagSelect" aria-label="Выбор доп. урока">
          <!-- Эти названия можно заменить на ваши реальные -->
          <option value="">— Выберите доп. урок —</option>
          <option value="A">Design og innovation</option>
          <option value="B">Musik</option>
        </select>
        <button id="confirmBtn" class="primary">Подтвердить</button>
      </div>
      <p class="note">Если выбран первый доп. урок — добавляется 8‑й урок в понедельник. Если второй — 8‑й урок в четверг.</p>

      <h3>Авто‑счётчик</h3>
      <div class="stats">
        <div class="stat">
          <div class="label">До конца учебного периода</div>
          <div class="value" id="weeksLeft">—</div>
        </div>
        <div class="stat">
          <div class="label">Уроков этой недели</div>
          <div class="value" id="lessonsThisWeek">—</div>
        </div>
      </div>
      <p class="note" id="termNote"></p>
    </aside>
  </main>

  <script>
    // ===== Конфиг данных =====
    // Задай реальную дату конца периода (например, конец четверти или года).
    // Формат: YYYY-MM-DD
    const TERM_END = "2026-06-20";

    // Базовое расписание без доп. уроков (примерные названия — поставь свои реальные)
    // Поддерживаются: monday, wednesday, thursday, friday
    const baseSchedule = {
      monday: [
        "Matematik", "Dansk", "Engelsk", "Historie", "Fysik", "Biologi", "Idræt"
        // 8-й урок добавится динамически при Valgfag A
      ],
      wednesday: [
        "Matematik", "Kemi", "Engelsk", "Geografi", "Musik", "Idræt"
      ],
      thursday: [
        "Matematik", "Biologi", "Engelsk", "Geografi", "Billedkunst", "Idræt"
        // 8-й урок добавится динамически при Valgfag B
      ],
      friday: [
        "Matematik", "Fysik", "Engelsk", "Historie", "Idræt", "Klassens time"
      ]
    };

    // Названия доп. уроков (первый влияет на понедельник, второй — на четверг)
    const VALGFAG_OPTIONS = {
      A: "Design og innovation", // первый
      B: "Musik"                 // второй
    };

    // ===== Вспомогательные =====
    const dayNames = {
      0: "Воскресенье", 1: "Понедельник", 2: "Вторник", 3: "Среда", 4: "Четверг", 5: "Пятница", 6: "Суббота"
    };
    const keyByWeekday = {
      1: "monday",
      3: "wednesday",
      4: "thursday",
      5: "friday"
    };

    function formatDate(d) {
      return d.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit", year: "numeric" });
    }

    function clone(obj) {
      return JSON.parse(JSON.stringify(obj));
    }

    // Добавляет Valgfag как 8-й урок в нужный день
    function applyValgfag(schedule, selectedKey) {
      if (!selectedKey) return schedule;
      const name = VALGFAG_OPTIONS[selectedKey];
      if (!name) return schedule;

      if (selectedKey === "A") {
        // первый — 8-й урок в понедельник
        const arr = schedule.monday ?? (schedule.monday = []);
        if (arr.length < 8) arr.push(name);
      } else if (selectedKey === "B") {
        // второй — 8-й урок в четверг
        const arr = schedule.thursday ?? (schedule.thursday = []);
        if (arr.length < 8) arr.push(name);
      }
      return schedule;
    }

    // Возвращает массив из двух дат: сегодня и завтра
    function getTodayAndTomorrow() {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
      return [today, tomorrow];
    }

    // Строит карточку дня
    function renderDayCard(container, date, scheduleForDay, valgfagKey) {
      const weekday = date.getDay(); // 0..6
      const dayName = dayNames[weekday];

      const card = document.createElement("div");
      card.className = "day-card";

      const head = document.createElement("div");
      head.className = "day-head";
      const nameEl = document.createElement("div");
      nameEl.className = "name";
      nameEl.textContent = dayName;
      const dateEl = document.createElement("div");
      dateEl.className = "date";
      dateEl.textContent = formatDate(date);
      head.appendChild(nameEl);
      head.appendChild(dateEl);

      const list = document.createElement("ul");
      list.className = "lessons";

      const subjects = scheduleForDay || [];
      if (subjects.length === 0) {
        const li = document.createElement("li");
        li.innerHTML = '<span class="muted">Нет уроков</span>';
        list.appendChild(li);
      } else {
        subjects.forEach((subj, idx) => {
          const li = document.createElement("li");
          const slot = document.createElement("div");
          slot.className = "slot";
          slot.textContent = (idx + 1);
          const subject = document.createElement("div");
          subject.className = "subject" + (isValgfagLabel(subj) ? " valgfag" : "");
          subject.textContent = subj;
          li.appendChild(slot);
          li.appendChild(subject);
          list.appendChild(li);
        });
      }

      card.appendChild(head);
      card.appendChild(list);
      container.appendChild(card);
    }

    function isValgfagLabel(name) {
      // Подсветка доп. урока, если совпадает с выбранными названиями
      return Object.values(VALGFAG_OPTIONS).includes(name);
    }

    function computeLessonsThisWeek(schedule) {
      const keys = ["monday", "wednesday", "thursday", "friday"];
      return keys.reduce((acc, k) => acc + ((schedule[k]?.length) || 0), 0);
    }

    function weeksUntilTermEnd(termEndStr) {
      const end = new Date(termEndStr + "T23:59:59");
      const now = new Date();
      const ms = end - now;
      if (isNaN(end.getTime())) return null;
      if (ms <= 0) return 0;
      const weeks = Math.ceil(ms / (7 * 24 * 60 * 60 * 1000));
      return weeks;
    }

    // ===== Рендер =====
    const daysRoot = document.getElementById("days");
    const valgfagSelect = document.getElementById("valgfagSelect");
    const confirmBtn = document.getElementById("confirmBtn");
    const weeksLeftEl = document.getElementById("weeksLeft");
    const lessonsThisWeekEl = document.getElementById("lessonsThisWeek");
    const termNoteEl = document.getElementById("termNote");

    let selectedValgfagKey = ""; // "" | "A" | "B"

    function renderAll() {
      // Копируем базовое и применяем выбранный доп. урок
      const schedule = applyValgfag(clone(baseSchedule), selectedValgfagKey);

      // Обновляем счётчики
      const weeks = weeksUntilTermEnd(TERM_END);
      weeksLeftEl.textContent = (weeks == null) ? "—" : (weeks === 0 ? "Период завершён" : weeks + " нед.");
      termNoteEl.textContent = (weeks == null)
        ? "Укажи корректную дату окончания периода в коде (TERM_END)."
        : (weeks === 0 ? "Новый период скоро начнётся — обнови TERM_END." : "Счёт идёт до " + new Date(TERM_END).toLocaleDateString("ru-RU"));

      lessonsThisWeekEl.textContent = computeLessonsThisWeek(schedule);

      // Рендерим только сегодня и завтра
      daysRoot.innerHTML = "";
      const [today, tomorrow] = getTodayAndTomorrow();

      [today, tomorrow].forEach(date => {
        const wd = date.getDay(); // 1..5 — будни
        const key = keyByWeekday[wd];
        const subjects = key ? schedule[key] : [];
        renderDayCard(daysRoot, date, subjects, selectedValgfagKey);
      });
    }

    confirmBtn.addEventListener("click", () => {
      const chosen = valgfagSelect.value;
      if (!chosen) {
        alert("Выберите доп. урок из списка.");
        return;
      }
      const label = VALGFAG_OPTIONS[chosen];
      const msg =
        chosen === "A"
          ? `Подтвердить: добавить "${label}" как 8‑й урок в понедельник?`
          : `Подтвердить: добавить "${label}" как 8‑й урок в четверг?`;
      if (confirm(msg)) {
        selectedValgfagKey = chosen;
        renderAll();
      }
    });

    // Первый рендер
    renderAll();
  </script>
</body>
</html>
